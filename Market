import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Scanner;


public class Market {
    public static void main(String[] args) {
        int viewChoice;
        Scanner scanner = new Scanner(System.in);
        do {
            System.out.println("Are you a customer (1) or seller (2)? ");
            viewChoice = scanner.nextInt();
            scanner.nextLine();

            if (viewChoice != 1 && viewChoice != 2) {
                System.out.println("Error.  Please enter either 1 or 2.");
            }
        } while (viewChoice != 1 && viewChoice != 2);

        // Split of how different types of users have different views
        // Think every user should have these fields
        String username;
        String password;
        String id;

        if (viewChoice == 1) {  // CUSTOMER
            // loading existing customers
            Customer customer;
            ArrayList<ArrayList<String>> existingUsers = loadCustomers();

            int existingAccount;
            do {
                System.out.println("Do you have an existing account (1 = Yes, 2 = No)? ");
                existingAccount = scanner.nextInt();
                scanner.nextLine();

                if (existingAccount != 1 && existingAccount != 2) {
                    System.out.println("Error.  Please enter either 1 or 2.");
                }
            } while (existingAccount != 1 && existingAccount != 2);



            if (existingAccount == 1) {  // There is an existing account
                int userIndex;  // user index relating username, password, and ids to a specific user

                while (true) {  // USERNAME
                    System.out.println("Enter Username: ");
                    username = scanner.nextLine().strip();
                    if (existingUsers.get(0).contains(username)) {
                        userIndex = existingUsers.get(0).indexOf(username);
                        break;
                    } else {
                        System.out.println("User not found. Try again!\n");
                    }
                }
                while (true) {  // PASSWORD
                    System.out.println("Enter Password: ");
                    password = scanner.nextLine();
                    if (existingUsers.get(1).get(userIndex).equals(password)) {  // If password is correct
                        break;
                    } else {
                        System.out.println("Incorrect Password. Try Again!\n");
                    }
                }

                customer = new Customer(existingUsers.get(0).get(userIndex),
                        existingUsers.get(1).get(userIndex), existingUsers.get(2).get(userIndex));

            } else {  // Creating new account
                System.out.println("Enter Username: ");
                username = scanner.nextLine().strip();
                System.out.println("Enter Password: ");
                password = scanner.nextLine().strip();
                int size = existingUsers.get(2).size();
                int newID = Integer.parseInt(existingUsers.get(2).get(size - 1) + 1); // makes an ID 1 more than prev
                String strID = String.format("%s", newID);


                customer = new Customer(username, password, strID);
            }

            // Both should converge here: Should show the market and allow the user to purchase/add to cart
            



        } else {  // SELLER

        }
    }

    public static ArrayList<ArrayList<String>> loadCustomers() {  // Static Method *******
        // This method reads the file and creates arraylist of arraylists of strings
        // index 0 of array list is arraylist holding usernames
        // index 1 = passwords
        // index 2 = id's
        // the second-dimension index is what matches the user's information between inner arraylists

        ArrayList<String> usernames = new ArrayList<>();
        ArrayList<String> passwords = new ArrayList<>();
        ArrayList<String> ids = new ArrayList<>();
        String s;
        try (BufferedReader bfr = new BufferedReader(new FileReader("C:\\Users\\owenw" +
                "\\OneDrive\\Desktop\\CS 180\\Proj4\\src\\customers.csv"))) {
            while (true) {
                s = bfr.readLine();
                if (s == null) {
                    break;
                }
                usernames.add(s.split(",")[0]);
                passwords.add(s.split(",")[1]);
                ids.add(s.split(",")[2]);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

        ArrayList<ArrayList<String>> users = new ArrayList<>();
        users.add(usernames);
        users.add(passwords);
        users.add(ids);

        return users;
    }

    public void loadMarket() {
        // TODO: Not sure if this will return anything, but should load stores and products for customer
    }


}
